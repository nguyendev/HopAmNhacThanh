/*!
 * jQuery Chord Transposer plugin v1.0
 * http://codegavin.com/projects/transposer
 *
 * Copyright 2010, Jesse Gavin
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://codegavin.com/license
 *
 * Date: Sat Jun 26 21:27:00 2010 -0600
 */
(function(n){n.fn.transpose=function(t){var u=n.extend({},n.fn.transpose.defaults,t),r=null,i=[{name:"Ab",value:0,type:"F"},{name:"A",value:1,type:"N"},{name:"A#",value:2,type:"S"},{name:"Bb",value:2,type:"F"},{name:"B",value:3,type:"N"},{name:"C",value:4,type:"N"},{name:"C#",value:5,type:"S"},{name:"Db",value:5,type:"F"},{name:"D",value:6,type:"N"},{name:"D#",value:7,type:"S"},{name:"Eb",value:7,type:"F"},{name:"E",value:8,type:"N"},{name:"F",value:9,type:"N"},{name:"F#",value:10,type:"S"},{name:"Gb",value:10,type:"F"},{name:"G",value:11,type:"N"},{name:"G#",value:0,type:"S"}],f=function(n){n.charAt(n.length-1)=="m"&&(n=n.substring(0,n.length-1));for(var t=0;t<i.length;t++)if(n==i[t].name)return i[t]},e=function(n){return n.length>1&&(n.charAt(1)=="b"||n.charAt(1)=="#")?n.substr(0,2):n.substr(0,1)},o=function(n,t,r){var e=f(n).value+t,u;if(e>11?e-=12:e<0&&(e+=12),u=0,e==0||e==2||e==5||e==7||e==10)switch(r.name){case"A":case"A#":case"B":case"C":case"C#":case"D":case"D#":case"E":case"F#":case"G":case"G#":for(;u<i.length;u++)if(i[u].value==e&&i[u].type=="S")return i[u];default:for(;u<i.length;u++)if(i[u].value==e&&i[u].type=="F")return i[u]}else for(;u<i.length;u++)if(i[u].value==e)return i[u]},p=function(n){switch(n.charAt(n.length-1)){case"b":return"F";case"#":return"S";default:return"N"}},s=function(n,t){return n>t?0-(n-t):n<t?0+(t-n):0},h=function(t,i){var u=f(i),e;r.name!=u.name&&(e=s(r.value,u.value),n("span.c",t).each(function(n,t){c(t,e,u)}),r=u)},c=function(t,i,r){var f=n(t),s=f.text(),h=e(s),y=o(h,i,r),c=y.name+s.substr(h.length),u,v;f.text(c);u=f[0].nextSibling;u&&u.nodeType==3&&u.nodeValue.length>0&&u.nodeValue.charAt(0)!="/"&&(v=l(s.length,c.length,u.nodeValue.length),u.nodeValue=a(" ",v))},l=function(n,t,i){return n>t?i+(n-t):n<t?i-(t-n):i},a=function(n,t){for(var i=[],r=0;r<t;r++)i.push(n);return i.join("")},v=function(t){for(var r=t.replace(/\s+/," ").split(" "),i=0;i<r.length;i++)if(!n.trim(r[i]).length==0&&!r[i].match(u.chordRegex))return!1;return!0},y=function(n){return n.replace(u.chordReplaceRegex,"<span class='c'>$1<\/span>")};return n(this).each(function(){var t=n(this).attr("data-key"),e,a,o,c;if(t&&n.trim(t)!=""||(t=u.key),!t||n.trim(t)=="")return this;r=f(t);e=[];n(i).each(function(n,t){r.name==t.name?e.push("<a href='#' class='selected'>"+t.name+"<\/a>"):e.push("<a href='#'>"+t.name+"<\/a>")});a=n(this);o=n("<div class='transpose-keys'><\/div>");o.html(e.join(""));n("a",o).click(function(t){return t.preventDefault(),h(a,n(this).text()),n(".transpose-keys a").removeClass("selected"),n(this).addClass("selected"),!1});n(this).before(o);var l=[],p=n(this).text().split(/\r\n|\n/g),s;for(c=0;c<p.length;c++)s=p[c],v(s)?l.push("<span>"+y(s)+"<\/span>"):l.push("<span>"+s+"<\/span>");n(this).html(l.join("\n"))})};n.fn.transpose.defaults={chordRegex:/^[A-G][b\#]?(2|5|6|7|9|11|13|6\/9|7\-5|7\-9|7\#5|7\#9|7\+5|7\+9|7b5|7b9|7sus2|7sus4|add2|add4|add9|aug|dim|dim7|m\/maj7|m6|m7|m7b5|m9|m11|m13|maj7|maj9|maj11|maj13|mb5|m|sus|sus2|sus4)*(\/[A-G][b\#]*)*$/,chordReplaceRegex:/([A-G][b\#]?(2|5|6|7|9|11|13|6\/9|7\-5|7\-9|7\#5|7\#9|7\+5|7\+9|7b5|7b9|7sus2|7sus4|add2|add4|add9|aug|dim|dim7|m\/maj7|m6|m7|m7b5|m9|m11|m13|maj7|maj9|maj11|maj13|mb5|m|sus|sus2|sus4)*)/g}})(jQuery);